"use strict";
/**
 * Unit tests for Lambda handlers
 * Tests the migration from Express routes to Lambda functions
 */
Object.defineProperty(exports, "__esModule", { value: true });
const handlers_1 = require("../src/handlers");
// Mock event helper
const createMockEvent = (httpMethod = 'GET', path = '/', queryStringParameters = null, pathParameters = null, body = null) => ({
    httpMethod,
    path,
    queryStringParameters,
    pathParameters,
    body,
    headers: {},
    multiValueHeaders: {},
    isBase64Encoded: false,
    requestContext: {
        requestId: 'test-request-id',
        stage: 'test',
        resourceId: 'test-resource',
        resourcePath: path,
        httpMethod,
        requestTime: '01/Jan/2024:00:00:00 +0000',
        requestTimeEpoch: Date.now(),
        identity: {
            sourceIp: '127.0.0.1',
            userAgent: 'test-agent',
            accessKey: null,
            accountId: null,
            apiKey: null,
            apiKeyId: null,
            caller: null,
            cognitoAuthenticationProvider: null,
            cognitoAuthenticationType: null,
            cognitoIdentityId: null,
            cognitoIdentityPoolId: null,
            principalOrgId: null,
            user: null,
            userArn: null,
            clientCert: null
        },
        accountId: 'test-account',
        apiId: 'test-api',
        protocol: 'HTTP/1.1',
        domainName: 'test-domain',
        domainPrefix: 'test',
        extendedRequestId: 'test-extended-id',
        path: path,
        authorizer: {}
    },
    resource: path,
    stageVariables: null,
    multiValueQueryStringParameters: null
});
describe('Lambda Handlers', () => {
    describe('Health Handler', () => {
        it('should return healthy status', async () => {
            const event = createMockEvent('GET', '/health');
            const result = await (0, handlers_1.healthHandler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.headers?.['Content-Type']).toBe('application/json');
            const body = JSON.parse(result.body);
            expect(body.status).toBe('healthy');
            expect(body.message).toBe('AIme Wellness Platform API');
            expect(body.dataInitialized).toBe(true);
        });
    });
    describe('Stats Handler', () => {
        it('should return community stats', async () => {
            const event = createMockEvent('GET', '/stats');
            const result = await (0, handlers_1.statsHandler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.headers?.['Content-Type']).toBe('application/json');
            const body = JSON.parse(result.body);
            expect(body.stats).toBeDefined();
            expect(body.stats.totalUsers).toBeGreaterThanOrEqual(0);
            expect(body.timestamp).toBeDefined();
        });
    });
    describe('Stories Handler', () => {
        it('should return user stories with default limit', async () => {
            const event = createMockEvent('GET', '/stories');
            const result = await (0, handlers_1.getStoriesHandler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.headers?.['Content-Type']).toBe('application/json');
            const body = JSON.parse(result.body);
            expect(body.stories).toBeDefined();
            expect(Array.isArray(body.stories)).toBe(true);
            expect(body.pagination).toBeDefined();
        });
        it('should respect limit query parameter', async () => {
            const event = createMockEvent('GET', '/stories', { limit: '5' });
            const result = await (0, handlers_1.getStoriesHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.stories.length).toBeLessThanOrEqual(5);
        });
        it('should return featured stories', async () => {
            const event = createMockEvent('GET', '/stories/featured');
            const result = await (0, handlers_1.getFeaturedStoriesHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.stories).toBeDefined();
            expect(Array.isArray(body.stories)).toBe(true);
        });
    });
    describe('Comedy Handler', () => {
        it('should return comedy content', async () => {
            const event = createMockEvent('GET', '/comedy');
            const result = await (0, handlers_1.getComedyHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.comedy).toBeDefined();
            expect(Array.isArray(body.comedy)).toBe(true);
        });
        it('should return featured comedy content', async () => {
            const event = createMockEvent('GET', '/comedy/featured');
            const result = await (0, handlers_1.getFeaturedComedyHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.comedy).toBeDefined();
            expect(Array.isArray(body.comedy)).toBe(true);
        });
    });
    describe('Search Handler', () => {
        it('should return search results', async () => {
            const event = createMockEvent('GET', '/search', { q: 'wellness' });
            const result = await (0, handlers_1.searchHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.results).toBeDefined();
            expect(body.query).toBe('wellness');
            expect(body.totalCount).toBeGreaterThanOrEqual(0);
        });
        it('should return 400 for missing query parameter', async () => {
            const event = createMockEvent('GET', '/search');
            const result = await (0, handlers_1.searchHandler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.code).toBe('VALIDATION_ERROR');
            expect(body.message).toContain('Query parameter "q" is required');
        });
    });
    describe('Interaction Handler', () => {
        it('should handle content interaction', async () => {
            const event = createMockEvent('POST', '/interact', null, null, JSON.stringify({
                contentId: 'story-1',
                action: 'like',
                contentType: 'story'
            }));
            const result = await (0, handlers_1.interactWithContentHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.success).toBe(true);
            expect(body.message).toContain('Successfully');
        });
        it('should return 400 for missing required fields', async () => {
            const event = createMockEvent('POST', '/interact', null, null, JSON.stringify({
                contentId: 'story-1'
                // missing action and contentType
            }));
            const result = await (0, handlers_1.interactWithContentHandler)(event);
            expect(result.statusCode).toBe(400);
            const body = JSON.parse(result.body);
            expect(body.code).toBe('VALIDATION_ERROR');
        });
    });
    describe('Categories Handler', () => {
        it('should return categories for content type', async () => {
            const event = createMockEvent('GET', '/categories/comedy', null, { contentType: 'comedy' });
            const result = await (0, handlers_1.getCategoriesHandler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.categories).toBeDefined();
            expect(Array.isArray(body.categories)).toBe(true);
            expect(body.contentType).toBe('comedy');
        });
    });
    describe('Error Handling', () => {
        it('should handle internal server errors gracefully', async () => {
            // This test would require mocking the MockDataService to throw an error
            // For now, we'll test that handlers return proper error structure
            const event = createMockEvent('GET', '/invalid-endpoint');
            // Since we don't have an invalid endpoint handler, this would be handled by API Gateway
            // But we can test that our handlers have proper error handling structure
            expect(true).toBe(true); // Placeholder assertion
        });
    });
    describe('CORS Headers', () => {
        it('should include CORS headers in all responses', async () => {
            const event = createMockEvent('GET', '/health');
            const result = await (0, handlers_1.healthHandler)(event);
            expect(result.headers?.['Access-Control-Allow-Origin']).toBe('*');
            expect(result.headers?.['Access-Control-Allow-Methods']).toBeDefined();
            expect(result.headers?.['Access-Control-Allow-Headers']).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlcnMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhhbmRsZXJzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFHSCw4Q0FtQnlCO0FBRXpCLG9CQUFvQjtBQUNwQixNQUFNLGVBQWUsR0FBRyxDQUN0QixhQUFxQixLQUFLLEVBQzFCLE9BQWUsR0FBRyxFQUNsQix3QkFBdUQsSUFBSSxFQUMzRCxpQkFBZ0QsSUFBSSxFQUNwRCxPQUFzQixJQUFJLEVBQ0osRUFBRSxDQUFDLENBQUM7SUFDMUIsVUFBVTtJQUNWLElBQUk7SUFDSixxQkFBcUI7SUFDckIsY0FBYztJQUNkLElBQUk7SUFDSixPQUFPLEVBQUUsRUFBRTtJQUNYLGlCQUFpQixFQUFFLEVBQUU7SUFDckIsZUFBZSxFQUFFLEtBQUs7SUFDdEIsY0FBYyxFQUFFO1FBQ2QsU0FBUyxFQUFFLGlCQUFpQjtRQUM1QixLQUFLLEVBQUUsTUFBTTtRQUNiLFVBQVUsRUFBRSxlQUFlO1FBQzNCLFlBQVksRUFBRSxJQUFJO1FBQ2xCLFVBQVU7UUFDVixXQUFXLEVBQUUsNEJBQTRCO1FBQ3pDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7UUFDNUIsUUFBUSxFQUFFO1lBQ1IsUUFBUSxFQUFFLFdBQVc7WUFDckIsU0FBUyxFQUFFLFlBQVk7WUFDdkIsU0FBUyxFQUFFLElBQUk7WUFDZixTQUFTLEVBQUUsSUFBSTtZQUNmLE1BQU0sRUFBRSxJQUFJO1lBQ1osUUFBUSxFQUFFLElBQUk7WUFDZCxNQUFNLEVBQUUsSUFBSTtZQUNaLDZCQUE2QixFQUFFLElBQUk7WUFDbkMseUJBQXlCLEVBQUUsSUFBSTtZQUMvQixpQkFBaUIsRUFBRSxJQUFJO1lBQ3ZCLHFCQUFxQixFQUFFLElBQUk7WUFDM0IsY0FBYyxFQUFFLElBQUk7WUFDcEIsSUFBSSxFQUFFLElBQUk7WUFDVixPQUFPLEVBQUUsSUFBSTtZQUNiLFVBQVUsRUFBRSxJQUFJO1NBQ2pC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QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVELE1BQU0sS0FBSyxHQUFHLGVBQWUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDaEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLHdCQUFhLEVBQUMsS0FBSyxDQUEwQixDQUFDO1lBRW5FLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsNkJBQTZCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsRSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLDhCQUE4QixDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2RSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLDhCQUE4QixDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN6RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXQgdGVzdHMgZm9yIExhbWJkYSBoYW5kbGVyc1xuICogVGVzdHMgdGhlIG1pZ3JhdGlvbiBmcm9tIEV4cHJlc3Mgcm91dGVzIHRvIExhbWJkYSBmdW5jdGlvbnNcbiAqL1xuXG5pbXBvcnQgeyBBUElHYXRld2F5UHJveHlFdmVudCwgQVBJR2F0ZXdheVByb3h5UmVzdWx0IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBcbiAgaGVhbHRoSGFuZGxlcixcbiAgc3RhdHNIYW5kbGVyLFxuICBnZXRTdG9yaWVzSGFuZGxlcixcbiAgZ2V0RmVhdHVyZWRTdG9yaWVzSGFuZGxlcixcbiAgZ2V0Q29tZWR5SGFuZGxlcixcbiAgZ2V0RmVhdHVyZWRDb21lZHlIYW5kbGVyLFxuICBnZXREaXNjdXNzaW9uc0hhbmRsZXIsXG4gIGdldEFjdGl2ZURpc2N1c3Npb25zSGFuZGxlcixcbiAgZ2V0UmVzb3VyY2VzSGFuZGxlcixcbiAgZ2V0RmVhdHVyZWRSZXNvdXJjZXNIYW5kbGVyLFxuICBnZXRQcm9kdWN0c0hhbmRsZXIsXG4gIGdldEZlYXR1cmVkUHJvZHVjdHNIYW5kbGVyLFxuICBnZXRVc2VyUHJvZmlsZXNIYW5kbGVyLFxuICBzZWFyY2hIYW5kbGVyLFxuICBnZXRSZWNvbW1lbmRhdGlvbnNIYW5kbGVyLFxuICBnZXRDYXRlZ29yaWVzSGFuZGxlcixcbiAgaW50ZXJhY3RXaXRoQ29udGVudEhhbmRsZXIsXG4gIGdldEhpZ2hsaWdodHNIYW5kbGVyXG59IGZyb20gJy4uL3NyYy9oYW5kbGVycyc7XG5cbi8vIE1vY2sgZXZlbnQgaGVscGVyXG5jb25zdCBjcmVhdGVNb2NrRXZlbnQgPSAoXG4gIGh0dHBNZXRob2Q6IHN0cmluZyA9ICdHRVQnLFxuICBwYXRoOiBzdHJpbmcgPSAnLycsXG4gIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IG51bGwgPSBudWxsLFxuICBwYXRoUGFyYW1ldGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IG51bGwgPSBudWxsLFxuICBib2R5OiBzdHJpbmcgfCBudWxsID0gbnVsbFxuKTogQVBJR2F0ZXdheVByb3h5RXZlbnQgPT4gKHtcbiAgaHR0cE1ldGhvZCxcbiAgcGF0aCxcbiAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzLFxuICBwYXRoUGFyYW1ldGVycyxcbiAgYm9keSxcbiAgaGVhZGVyczoge30sXG4gIG11bHRpVmFsdWVIZWFkZXJzOiB7fSxcbiAgaXNCYXNlNjRFbmNvZGVkOiBmYWxzZSxcbiAgcmVxdWVzdENvbnRleHQ6IHtcbiAgICByZXF1ZXN0SWQ6ICd0ZXN0LXJlcXVlc3QtaWQnLFxuICAgIHN0YWdlOiAndGVzdCcsXG4gICAgcmVzb3VyY2VJZDogJ3Rlc3QtcmVzb3VyY2UnLFxuICAgIHJlc291cmNlUGF0aDogcGF0aCxcbiAgICBodHRwTWV0aG9kLFxuICAgIHJlcXVlc3RUaW1lOiAnMDEvSmFuLzIwMjQ6MDA6MDA6MDAgKzAwMDAnLFxuICAgIHJlcXVlc3RUaW1lRXBvY2g6IERhdGUubm93KCksXG4gICAgaWRlbnRpdHk6IHtcbiAgICAgIHNvdXJjZUlwOiAnMTI3LjAuMC4xJyxcbiAgICAgIHVzZXJBZ2VudDogJ3Rlc3QtYWdlbnQnLFxuICAgICAgYWNjZXNzS2V5OiBudWxsLFxuICAgICAgYWNjb3VudElkOiBudWxsLFxuICAgICAgYXBpS2V5OiBudWxsLFxuICAgICAgYXBpS2V5SWQ6IG51bGwsXG4gICAgICBjYWxsZXI6IG51bGwsXG4gICAgICBjb2duaXRvQXV0aGVudGljYXRpb25Qcm92aWRlcjogbnVsbCxcbiAgICAgIGNvZ25pdG9BdXRoZW50aWNhdGlvblR5cGU6IG51bGwsXG4gICAgICBjb2duaXRvSWRlbnRpdHlJZDogbnVsbCxcbiAgICAgIGNvZ25pdG9JZGVudGl0eVBvb2xJZDogbnVsbCxcbiAgICAgIHByaW5jaXBhbE9yZ0lkOiBudWxsLFxuICAgICAgdXNlcjogbnVsbCxcbiAgICAgIHVzZXJBcm46IG51bGwsXG4gICAgICBjbGllbnRDZXJ0OiBudWxsXG4gICAgfSxcbiAgICBhY2NvdW50SWQ6ICd0ZXN0LWFjY291bnQnLFxuICAgIGFwaUlkOiAndGVzdC1hcGknLFxuICAgIHByb3RvY29sOiAnSFRUUC8xLjEnLFxuICAgIGRvbWFpbk5hbWU6ICd0ZXN0LWRvbWFpbicsXG4gICAgZG9tYWluUHJlZml4OiAndGVzdCcsXG4gICAgZXh0ZW5kZWRSZXF1ZXN0SWQ6ICd0ZXN0LWV4dGVuZGVkLWlkJyxcbiAgICBwYXRoOiBwYXRoLFxuICAgIGF1dGhvcml6ZXI6IHt9XG4gIH0gYXMgYW55LFxuICByZXNvdXJjZTogcGF0aCxcbiAgc3RhZ2VWYXJpYWJsZXM6IG51bGwsXG4gIG11bHRpVmFsdWVRdWVyeVN0cmluZ1BhcmFtZXRlcnM6IG51bGxcbn0pO1xuXG5kZXNjcmliZSgnTGFtYmRhIEhhbmRsZXJzJywgKCkgPT4ge1xuICBkZXNjcmliZSgnSGVhbHRoIEhhbmRsZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gaGVhbHRoeSBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCgnR0VUJywgJy9oZWFsdGgnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhlYWx0aEhhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVJlc3VsdDtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQ29udGVudC1UeXBlJ10pLnRvQmUoJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuc3RhdHVzKS50b0JlKCdoZWFsdGh5Jyk7XG4gICAgICBleHBlY3QoYm9keS5tZXNzYWdlKS50b0JlKCdBSW1lIFdlbGxuZXNzIFBsYXRmb3JtIEFQSScpO1xuICAgICAgZXhwZWN0KGJvZHkuZGF0YUluaXRpYWxpemVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3RhdHMgSGFuZGxlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tdW5pdHkgc3RhdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCgnR0VUJywgJy9zdGF0cycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3RhdHNIYW5kbGVyKGV2ZW50KSBhcyBBUElHYXRld2F5UHJveHlSZXN1bHQ7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzPy5bJ0NvbnRlbnQtVHlwZSddKS50b0JlKCdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcbiAgICAgIGV4cGVjdChib2R5LnN0YXRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGJvZHkuc3RhdHMudG90YWxVc2VycykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChib2R5LnRpbWVzdGFtcCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N0b3JpZXMgSGFuZGxlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIHN0b3JpZXMgd2l0aCBkZWZhdWx0IGxpbWl0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVNb2NrRXZlbnQoJ0dFVCcsICcvc3RvcmllcycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0U3Rvcmllc0hhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVJlc3VsdDtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQ29udGVudC1UeXBlJ10pLnRvQmUoJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuc3RvcmllcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGJvZHkuc3RvcmllcykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoYm9keS5wYWdpbmF0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IGxpbWl0IHF1ZXJ5IHBhcmFtZXRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KCdHRVQnLCAnL3N0b3JpZXMnLCB7IGxpbWl0OiAnNScgfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRTdG9yaWVzSGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuc3Rvcmllcy5sZW5ndGgpLnRvQmVMZXNzVGhhbk9yRXF1YWwoNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmZWF0dXJlZCBzdG9yaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVNb2NrRXZlbnQoJ0dFVCcsICcvc3Rvcmllcy9mZWF0dXJlZCcpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0RmVhdHVyZWRTdG9yaWVzSGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuc3RvcmllcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGJvZHkuc3RvcmllcykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb21lZHkgSGFuZGxlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21lZHkgY29udGVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KCdHRVQnLCAnL2NvbWVkeScpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0Q29tZWR5SGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuY29tZWR5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkoYm9keS5jb21lZHkpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmVhdHVyZWQgY29tZWR5IGNvbnRlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCgnR0VUJywgJy9jb21lZHkvZmVhdHVyZWQnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldEZlYXR1cmVkQ29tZWR5SGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuY29tZWR5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkoYm9keS5jb21lZHkpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VhcmNoIEhhbmRsZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2VhcmNoIHJlc3VsdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCgnR0VUJywgJy9zZWFyY2gnLCB7IHE6ICd3ZWxsbmVzcycgfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZWFyY2hIYW5kbGVyKGV2ZW50KSBhcyBBUElHYXRld2F5UHJveHlSZXN1bHQ7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgXG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XG4gICAgICBleHBlY3QoYm9keS5yZXN1bHRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGJvZHkucXVlcnkpLnRvQmUoJ3dlbGxuZXNzJyk7XG4gICAgICBleHBlY3QoYm9keS50b3RhbENvdW50KS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gNDAwIGZvciBtaXNzaW5nIHF1ZXJ5IHBhcmFtZXRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KCdHRVQnLCAnL3NlYXJjaCcpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VhcmNoSGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNDAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuY29kZSkudG9CZSgnVkFMSURBVElPTl9FUlJPUicpO1xuICAgICAgZXhwZWN0KGJvZHkubWVzc2FnZSkudG9Db250YWluKCdRdWVyeSBwYXJhbWV0ZXIgXCJxXCIgaXMgcmVxdWlyZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludGVyYWN0aW9uIEhhbmRsZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29udGVudCBpbnRlcmFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KCdQT1NUJywgJy9pbnRlcmFjdCcsIG51bGwsIG51bGwsIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgY29udGVudElkOiAnc3RvcnktMScsXG4gICAgICAgIGFjdGlvbjogJ2xpa2UnLFxuICAgICAgICBjb250ZW50VHlwZTogJ3N0b3J5J1xuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnRlcmFjdFdpdGhDb250ZW50SGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xuICAgICAgZXhwZWN0KGJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChib2R5Lm1lc3NhZ2UpLnRvQ29udGFpbignU3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDAgZm9yIG1pc3NpbmcgcmVxdWlyZWQgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVNb2NrRXZlbnQoJ1BPU1QnLCAnL2ludGVyYWN0JywgbnVsbCwgbnVsbCwgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBjb250ZW50SWQ6ICdzdG9yeS0xJ1xuICAgICAgICAvLyBtaXNzaW5nIGFjdGlvbiBhbmQgY29udGVudFR5cGVcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaW50ZXJhY3RXaXRoQ29udGVudEhhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVJlc3VsdDtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDQwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcbiAgICAgIGV4cGVjdChib2R5LmNvZGUpLnRvQmUoJ1ZBTElEQVRJT05fRVJST1InKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NhdGVnb3JpZXMgSGFuZGxlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjYXRlZ29yaWVzIGZvciBjb250ZW50IHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCgnR0VUJywgJy9jYXRlZ29yaWVzL2NvbWVkeScsIG51bGwsIHsgY29udGVudFR5cGU6ICdjb21lZHknIH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0Q2F0ZWdvcmllc0hhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVJlc3VsdDtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcbiAgICAgIGV4cGVjdChib2R5LmNhdGVnb3JpZXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShib2R5LmNhdGVnb3JpZXMpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGJvZHkuY29udGVudFR5cGUpLnRvQmUoJ2NvbWVkeScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW50ZXJuYWwgc2VydmVyIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGhpcyB0ZXN0IHdvdWxkIHJlcXVpcmUgbW9ja2luZyB0aGUgTW9ja0RhdGFTZXJ2aWNlIHRvIHRocm93IGFuIGVycm9yXG4gICAgICAvLyBGb3Igbm93LCB3ZSdsbCB0ZXN0IHRoYXQgaGFuZGxlcnMgcmV0dXJuIHByb3BlciBlcnJvciBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KCdHRVQnLCAnL2ludmFsaWQtZW5kcG9pbnQnKTtcbiAgICAgIFxuICAgICAgLy8gU2luY2Ugd2UgZG9uJ3QgaGF2ZSBhbiBpbnZhbGlkIGVuZHBvaW50IGhhbmRsZXIsIHRoaXMgd291bGQgYmUgaGFuZGxlZCBieSBBUEkgR2F0ZXdheVxuICAgICAgLy8gQnV0IHdlIGNhbiB0ZXN0IHRoYXQgb3VyIGhhbmRsZXJzIGhhdmUgcHJvcGVyIGVycm9yIGhhbmRsaW5nIHN0cnVjdHVyZVxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7IC8vIFBsYWNlaG9sZGVyIGFzc2VydGlvblxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ09SUyBIZWFkZXJzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBDT1JTIGhlYWRlcnMgaW4gYWxsIHJlc3BvbnNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KCdHRVQnLCAnL2hlYWx0aCcpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGVhbHRoSGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0O1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJ10pLnRvQmUoJyonKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaGVhZGVycz8uWydBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJ10pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyddKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==