"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TitanAnalyticsProcessor = void 0;
/**
 * Basic analytics processor that stores events in TitanKCache so that
 * recommendation pipelines can leverage recent user activity.
 */
class TitanAnalyticsProcessor {
    constructor(cache) {
        this.cache = cache;
    }
    async record(event) {
        const fullEvent = { ...event, timestamp: event.timestamp || Date.now() };
        const key = ['events', fullEvent.userId];
        const existing = (await this.cache.get(key)) || [];
        existing.push(fullEvent);
        await this.cache.set(key, existing);
    }
    async getEvents(userId) {
        return (await this.cache.get(['events', userId])) || [];
    }
}
exports.TitanAnalyticsProcessor = TitanAnalyticsProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLXByb2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zZXJ2aWNlL2FuYWx5dGljcy1wcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBVUE7OztHQUdHO0FBQ0gsTUFBYSx1QkFBdUI7SUFHbEMsWUFBWSxLQUFnQztRQUMxQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNyQixDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFpQjtRQUM1QixNQUFNLFNBQVMsR0FBZSxFQUFFLEdBQUcsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBQ3JGLE1BQU0sR0FBRyxHQUFHLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6QyxNQUFNLFFBQVEsR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbkQsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN6QixNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFjO1FBQzVCLE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUQsQ0FBQztDQUNGO0FBbEJELDBEQWtCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRpdGFuS0NhY2hlIH0gZnJvbSAnLi9rY2FjaGUnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRpdGFuRXZlbnQge1xuICB1c2VySWQ6IHN0cmluZztcbiAgZXZlbnRUeXBlOiAncGFnZScgfCAnaW50ZXJhY3Rpb24nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHRpbWVzdGFtcD86IG51bWJlcjtcbiAgZGF0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG4vKipcbiAqIEJhc2ljIGFuYWx5dGljcyBwcm9jZXNzb3IgdGhhdCBzdG9yZXMgZXZlbnRzIGluIFRpdGFuS0NhY2hlIHNvIHRoYXRcbiAqIHJlY29tbWVuZGF0aW9uIHBpcGVsaW5lcyBjYW4gbGV2ZXJhZ2UgcmVjZW50IHVzZXIgYWN0aXZpdHkuXG4gKi9cbmV4cG9ydCBjbGFzcyBUaXRhbkFuYWx5dGljc1Byb2Nlc3NvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2FjaGU6IFRpdGFuS0NhY2hlPFRpdGFuRXZlbnRbXT47XG5cbiAgY29uc3RydWN0b3IoY2FjaGU6IFRpdGFuS0NhY2hlPFRpdGFuRXZlbnRbXT4pIHtcbiAgICB0aGlzLmNhY2hlID0gY2FjaGU7XG4gIH1cblxuICBhc3luYyByZWNvcmQoZXZlbnQ6IFRpdGFuRXZlbnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBmdWxsRXZlbnQ6IFRpdGFuRXZlbnQgPSB7IC4uLmV2ZW50LCB0aW1lc3RhbXA6IGV2ZW50LnRpbWVzdGFtcCB8fCBEYXRlLm5vdygpIH07XG4gICAgY29uc3Qga2V5ID0gWydldmVudHMnLCBmdWxsRXZlbnQudXNlcklkXTtcbiAgICBjb25zdCBleGlzdGluZyA9IChhd2FpdCB0aGlzLmNhY2hlLmdldChrZXkpKSB8fCBbXTtcbiAgICBleGlzdGluZy5wdXNoKGZ1bGxFdmVudCk7XG4gICAgYXdhaXQgdGhpcy5jYWNoZS5zZXQoa2V5LCBleGlzdGluZyk7XG4gIH1cblxuICBhc3luYyBnZXRFdmVudHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFRpdGFuRXZlbnRbXT4ge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy5jYWNoZS5nZXQoWydldmVudHMnLCB1c2VySWRdKSkgfHwgW107XG4gIH1cbn1cblxuIl19