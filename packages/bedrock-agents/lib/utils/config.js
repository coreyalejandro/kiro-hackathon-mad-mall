"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.testConfig = exports.productionConfig = exports.developmentConfig = exports.ConfigManager = exports.defaultConfig = void 0;
exports.getEnvironmentConfig = getEnvironmentConfig;
exports.createConfigFromEnvironment = createConfigFromEnvironment;
// Default configuration
exports.defaultConfig = {
    aws: {
        region: process.env.AWS_REGION || 'us-east-1',
        accessKeyId: process.env.AWS_ACCESS_KEY_ID,
        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,
        sessionToken: process.env.AWS_SESSION_TOKEN,
    },
    agents: {
        defaultModelId: process.env.BEDROCK_DEFAULT_MODEL_ID || 'anthropic.claude-3-sonnet-20240229-v1:0',
        defaultTemperature: parseFloat(process.env.BEDROCK_DEFAULT_TEMPERATURE || '0.7'),
        defaultMaxTokens: parseInt(process.env.BEDROCK_DEFAULT_MAX_TOKENS || '2000'),
        defaultTopP: parseFloat(process.env.BEDROCK_DEFAULT_TOP_P || '0.9'),
        timeout: parseInt(process.env.BEDROCK_TIMEOUT || '30000'), // 30 seconds
    },
    workflows: {
        maxExecutionTime: parseInt(process.env.WORKFLOW_MAX_EXECUTION_TIME || '300000'), // 5 minutes
        defaultRetryAttempts: parseInt(process.env.WORKFLOW_DEFAULT_RETRY_ATTEMPTS || '3'),
        cleanupInterval: parseInt(process.env.WORKFLOW_CLEANUP_INTERVAL || '3600000'), // 1 hour
    },
    logging: {
        level: process.env.LOG_LEVEL || 'info',
        enableMetrics: process.env.ENABLE_METRICS === 'true',
        enableTracing: process.env.ENABLE_TRACING === 'true',
    },
};
// Configuration manager
class ConfigManager {
    constructor(config) {
        this.config = this.mergeConfig(exports.defaultConfig, config || {});
    }
    static getInstance(config) {
        if (!ConfigManager.instance) {
            ConfigManager.instance = new ConfigManager(config);
        }
        return ConfigManager.instance;
    }
    getConfig() {
        return { ...this.config };
    }
    updateConfig(updates) {
        this.config = this.mergeConfig(this.config, updates);
    }
    // Get agent-specific configuration
    getAgentConfig(agentId, overrides) {
        const baseConfig = {
            agentId,
            agentName: agentId,
            description: `Agent: ${agentId}`,
            modelId: this.config.agents.defaultModelId,
            temperature: this.config.agents.defaultTemperature,
            maxTokens: this.config.agents.defaultMaxTokens,
            topP: this.config.agents.defaultTopP,
        };
        return { ...baseConfig, ...overrides };
    }
    // Validate configuration
    validateConfig() {
        const errors = [];
        // Validate AWS configuration
        if (!this.config.aws.region) {
            errors.push('AWS region is required');
        }
        // Validate agent configuration
        if (this.config.agents.defaultTemperature < 0 || this.config.agents.defaultTemperature > 1) {
            errors.push('Default temperature must be between 0 and 1');
        }
        if (this.config.agents.defaultMaxTokens <= 0) {
            errors.push('Default max tokens must be positive');
        }
        if (this.config.agents.defaultTopP < 0 || this.config.agents.defaultTopP > 1) {
            errors.push('Default top-p must be between 0 and 1');
        }
        // Validate workflow configuration
        if (this.config.workflows.maxExecutionTime <= 0) {
            errors.push('Max execution time must be positive');
        }
        if (this.config.workflows.defaultRetryAttempts < 0) {
            errors.push('Default retry attempts must be non-negative');
        }
        if (errors.length > 0) {
            throw new Error(`Configuration validation failed: ${errors.join(', ')}`);
        }
    }
    // Deep merge configuration objects
    mergeConfig(base, updates) {
        const result = { ...base };
        for (const [key, value] of Object.entries(updates)) {
            if (value !== undefined) {
                if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                    result[key] = { ...result[key], ...value };
                }
                else {
                    result[key] = value;
                }
            }
        }
        return result;
    }
}
exports.ConfigManager = ConfigManager;
// Environment-specific configurations
exports.developmentConfig = {
    logging: {
        level: 'debug',
        enableMetrics: true,
        enableTracing: true,
    },
    workflows: {
        maxExecutionTime: 600000, // 10 minutes for development
        defaultRetryAttempts: 1, // Fewer retries for faster feedback
        cleanupInterval: 1800000, // 30 minutes
    },
};
exports.productionConfig = {
    logging: {
        level: 'warn',
        enableMetrics: true,
        enableTracing: false,
    },
    workflows: {
        maxExecutionTime: 300000, // 5 minutes
        defaultRetryAttempts: 3,
        cleanupInterval: 3600000, // 1 hour
    },
};
exports.testConfig = {
    agents: {
        defaultModelId: 'mock-model',
        defaultTemperature: 0.5,
        defaultMaxTokens: 1000,
        defaultTopP: 0.8,
        timeout: 5000, // 5 seconds for tests
    },
    logging: {
        level: 'error',
        enableMetrics: false,
        enableTracing: false,
    },
    workflows: {
        maxExecutionTime: 30000, // 30 seconds for tests
        defaultRetryAttempts: 1,
        cleanupInterval: 60000, // 1 minute
    },
};
// Utility functions
function getEnvironmentConfig() {
    const env = process.env.NODE_ENV || 'development';
    switch (env) {
        case 'production':
            return exports.productionConfig;
        case 'test':
            return exports.testConfig;
        case 'development':
        default:
            return exports.developmentConfig;
    }
}
function createConfigFromEnvironment() {
    const envConfig = getEnvironmentConfig();
    const manager = ConfigManager.getInstance(envConfig);
    manager.validateConfig();
    return manager.getConfig();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFxTUEsb0RBWUM7QUFFRCxrRUFLQztBQTNMRCx3QkFBd0I7QUFDWCxRQUFBLGFBQWEsR0FBd0I7SUFDaEQsR0FBRyxFQUFFO1FBQ0gsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLFdBQVc7UUFDN0MsV0FBVyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCO1FBQzFDLGVBQWUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQjtRQUNsRCxZQUFZLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUI7S0FDNUM7SUFDRCxNQUFNLEVBQUU7UUFDTixjQUFjLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsSUFBSSx5Q0FBeUM7UUFDakcsa0JBQWtCLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLElBQUksS0FBSyxDQUFDO1FBQ2hGLGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixJQUFJLE1BQU0sQ0FBQztRQUM1RSxXQUFXLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUksS0FBSyxDQUFDO1FBQ25FLE9BQU8sRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLElBQUksT0FBTyxDQUFDLEVBQUUsYUFBYTtLQUN6RTtJQUNELFNBQVMsRUFBRTtRQUNULGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixJQUFJLFFBQVEsQ0FBQyxFQUFFLFlBQVk7UUFDN0Ysb0JBQW9CLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLElBQUksR0FBRyxDQUFDO1FBQ2xG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QUNGLENBQUM7QUFFRixvQkFBb0I7QUFDcEIsU0FBZ0Isb0JBQW9CO0lBQ2xDLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLGFBQWEsQ0FBQztJQUVsRCxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ1osS0FBSyxZQUFZO1lBQ2YsT0FBTyx3QkFBZ0IsQ0FBQztRQUMxQixLQUFLLE1BQU07WUFDVCxPQUFPLGtCQUFVLENBQUM7UUFDcEIsS0FBSyxhQUFhLENBQUM7UUFDbkI7WUFDRSxPQUFPLHlCQUFpQixDQUFDO0lBQzdCLENBQUM7QUFDSCxDQUFDO0FBRUQsU0FBZ0IsMkJBQTJCO0lBQ3pDLE1BQU0sU0FBUyxHQUFHLG9CQUFvQixFQUFFLENBQUM7SUFDekMsTUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyRCxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDekIsT0FBTyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDN0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFnZW50Q29uZmlnIH0gZnJvbSAnLi4vdHlwZXMvYWdlbnQtdHlwZXMnO1xuXG4vLyBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIEJlZHJvY2tBZ2VudHNDb25maWcge1xuICBhd3M6IHtcbiAgICByZWdpb246IHN0cmluZztcbiAgICBhY2Nlc3NLZXlJZD86IHN0cmluZztcbiAgICBzZWNyZXRBY2Nlc3NLZXk/OiBzdHJpbmc7XG4gICAgc2Vzc2lvblRva2VuPzogc3RyaW5nO1xuICB9O1xuICBhZ2VudHM6IHtcbiAgICBkZWZhdWx0TW9kZWxJZDogc3RyaW5nO1xuICAgIGRlZmF1bHRUZW1wZXJhdHVyZTogbnVtYmVyO1xuICAgIGRlZmF1bHRNYXhUb2tlbnM6IG51bWJlcjtcbiAgICBkZWZhdWx0VG9wUDogbnVtYmVyO1xuICAgIHRpbWVvdXQ6IG51bWJlcjtcbiAgfTtcbiAgd29ya2Zsb3dzOiB7XG4gICAgbWF4RXhlY3V0aW9uVGltZTogbnVtYmVyO1xuICAgIGRlZmF1bHRSZXRyeUF0dGVtcHRzOiBudW1iZXI7XG4gICAgY2xlYW51cEludGVydmFsOiBudW1iZXI7XG4gIH07XG4gIGxvZ2dpbmc6IHtcbiAgICBsZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcic7XG4gICAgZW5hYmxlTWV0cmljczogYm9vbGVhbjtcbiAgICBlbmFibGVUcmFjaW5nOiBib29sZWFuO1xuICB9O1xufVxuXG4vLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBjb25zdCBkZWZhdWx0Q29uZmlnOiBCZWRyb2NrQWdlbnRzQ29uZmlnID0ge1xuICBhd3M6IHtcbiAgICByZWdpb246IHByb2Nlc3MuZW52LkFXU19SRUdJT04gfHwgJ3VzLWVhc3QtMScsXG4gICAgYWNjZXNzS2V5SWQ6IHByb2Nlc3MuZW52LkFXU19BQ0NFU1NfS0VZX0lELFxuICAgIHNlY3JldEFjY2Vzc0tleTogcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZLFxuICAgIHNlc3Npb25Ub2tlbjogcHJvY2Vzcy5lbnYuQVdTX1NFU1NJT05fVE9LRU4sXG4gIH0sXG4gIGFnZW50czoge1xuICAgIGRlZmF1bHRNb2RlbElkOiBwcm9jZXNzLmVudi5CRURST0NLX0RFRkFVTFRfTU9ERUxfSUQgfHwgJ2FudGhyb3BpYy5jbGF1ZGUtMy1zb25uZXQtMjAyNDAyMjktdjE6MCcsXG4gICAgZGVmYXVsdFRlbXBlcmF0dXJlOiBwYXJzZUZsb2F0KHByb2Nlc3MuZW52LkJFRFJPQ0tfREVGQVVMVF9URU1QRVJBVFVSRSB8fCAnMC43JyksXG4gICAgZGVmYXVsdE1heFRva2VuczogcGFyc2VJbnQocHJvY2Vzcy5lbnYuQkVEUk9DS19ERUZBVUxUX01BWF9UT0tFTlMgfHwgJzIwMDAnKSxcbiAgICBkZWZhdWx0VG9wUDogcGFyc2VGbG9hdChwcm9jZXNzLmVudi5CRURST0NLX0RFRkFVTFRfVE9QX1AgfHwgJzAuOScpLFxuICAgIHRpbWVvdXQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LkJFRFJPQ0tfVElNRU9VVCB8fCAnMzAwMDAnKSwgLy8gMzAgc2Vjb25kc1xuICB9LFxuICB3b3JrZmxvd3M6IHtcbiAgICBtYXhFeGVjdXRpb25UaW1lOiBwYXJzZUludChwcm9jZXNzLmVudi5XT1JLRkxPV19NQVhfRVhFQ1VUSU9OX1RJTUUgfHwgJzMwMDAwMCcpLCAvLyA1IG1pbnV0ZXNcbiAgICBkZWZhdWx0UmV0cnlBdHRlbXB0czogcGFyc2VJbnQocHJvY2Vzcy5lbnYuV09SS0ZMT1dfREVGQVVMVF9SRVRSWV9BVFRFTVBUUyB8fCAnMycpLFxuICAgIGNsZWFudXBJbnRlcnZhbDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuV09SS0ZMT1dfQ0xFQU5VUF9JTlRFUlZBTCB8fCAnMzYwMDAwMCcpLCAvLyAxIGhvdXJcbiAgfSxcbiAgbG9nZ2luZzoge1xuICAgIGxldmVsOiAocHJvY2Vzcy5lbnYuTE9HX0xFVkVMIGFzIGFueSkgfHwgJ2luZm8nLFxuICAgIGVuYWJsZU1ldHJpY3M6IHByb2Nlc3MuZW52LkVOQUJMRV9NRVRSSUNTID09PSAndHJ1ZScsXG4gICAgZW5hYmxlVHJhY2luZzogcHJvY2Vzcy5lbnYuRU5BQkxFX1RSQUNJTkcgPT09ICd0cnVlJyxcbiAgfSxcbn07XG5cbi8vIENvbmZpZ3VyYXRpb24gbWFuYWdlclxuZXhwb3J0IGNsYXNzIENvbmZpZ01hbmFnZXIge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQ29uZmlnTWFuYWdlcjtcbiAgcHJpdmF0ZSBjb25maWc6IEJlZHJvY2tBZ2VudHNDb25maWc7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3Rvcihjb25maWc/OiBQYXJ0aWFsPEJlZHJvY2tBZ2VudHNDb25maWc+KSB7XG4gICAgdGhpcy5jb25maWcgPSB0aGlzLm1lcmdlQ29uZmlnKGRlZmF1bHRDb25maWcsIGNvbmZpZyB8fCB7fSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoY29uZmlnPzogUGFydGlhbDxCZWRyb2NrQWdlbnRzQ29uZmlnPik6IENvbmZpZ01hbmFnZXIge1xuICAgIGlmICghQ29uZmlnTWFuYWdlci5pbnN0YW5jZSkge1xuICAgICAgQ29uZmlnTWFuYWdlci5pbnN0YW5jZSA9IG5ldyBDb25maWdNYW5hZ2VyKGNvbmZpZyk7XG4gICAgfVxuICAgIHJldHVybiBDb25maWdNYW5hZ2VyLmluc3RhbmNlO1xuICB9XG5cbiAgZ2V0Q29uZmlnKCk6IEJlZHJvY2tBZ2VudHNDb25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cblxuICB1cGRhdGVDb25maWcodXBkYXRlczogUGFydGlhbDxCZWRyb2NrQWdlbnRzQ29uZmlnPik6IHZvaWQge1xuICAgIHRoaXMuY29uZmlnID0gdGhpcy5tZXJnZUNvbmZpZyh0aGlzLmNvbmZpZywgdXBkYXRlcyk7XG4gIH1cblxuICAvLyBHZXQgYWdlbnQtc3BlY2lmaWMgY29uZmlndXJhdGlvblxuICBnZXRBZ2VudENvbmZpZyhhZ2VudElkOiBzdHJpbmcsIG92ZXJyaWRlcz86IFBhcnRpYWw8QWdlbnRDb25maWc+KTogQWdlbnRDb25maWcge1xuICAgIGNvbnN0IGJhc2VDb25maWc6IEFnZW50Q29uZmlnID0ge1xuICAgICAgYWdlbnRJZCxcbiAgICAgIGFnZW50TmFtZTogYWdlbnRJZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgQWdlbnQ6ICR7YWdlbnRJZH1gLFxuICAgICAgbW9kZWxJZDogdGhpcy5jb25maWcuYWdlbnRzLmRlZmF1bHRNb2RlbElkLFxuICAgICAgdGVtcGVyYXR1cmU6IHRoaXMuY29uZmlnLmFnZW50cy5kZWZhdWx0VGVtcGVyYXR1cmUsXG4gICAgICBtYXhUb2tlbnM6IHRoaXMuY29uZmlnLmFnZW50cy5kZWZhdWx0TWF4VG9rZW5zLFxuICAgICAgdG9wUDogdGhpcy5jb25maWcuYWdlbnRzLmRlZmF1bHRUb3BQLFxuICAgIH07XG5cbiAgICByZXR1cm4geyAuLi5iYXNlQ29uZmlnLCAuLi5vdmVycmlkZXMgfTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIGNvbmZpZ3VyYXRpb25cbiAgdmFsaWRhdGVDb25maWcoKTogdm9pZCB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLy8gVmFsaWRhdGUgQVdTIGNvbmZpZ3VyYXRpb25cbiAgICBpZiAoIXRoaXMuY29uZmlnLmF3cy5yZWdpb24pIHtcbiAgICAgIGVycm9ycy5wdXNoKCdBV1MgcmVnaW9uIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYWdlbnQgY29uZmlndXJhdGlvblxuICAgIGlmICh0aGlzLmNvbmZpZy5hZ2VudHMuZGVmYXVsdFRlbXBlcmF0dXJlIDwgMCB8fCB0aGlzLmNvbmZpZy5hZ2VudHMuZGVmYXVsdFRlbXBlcmF0dXJlID4gMSkge1xuICAgICAgZXJyb3JzLnB1c2goJ0RlZmF1bHQgdGVtcGVyYXR1cmUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jb25maWcuYWdlbnRzLmRlZmF1bHRNYXhUb2tlbnMgPD0gMCkge1xuICAgICAgZXJyb3JzLnB1c2goJ0RlZmF1bHQgbWF4IHRva2VucyBtdXN0IGJlIHBvc2l0aXZlJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29uZmlnLmFnZW50cy5kZWZhdWx0VG9wUCA8IDAgfHwgdGhpcy5jb25maWcuYWdlbnRzLmRlZmF1bHRUb3BQID4gMSkge1xuICAgICAgZXJyb3JzLnB1c2goJ0RlZmF1bHQgdG9wLXAgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEnKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSB3b3JrZmxvdyBjb25maWd1cmF0aW9uXG4gICAgaWYgKHRoaXMuY29uZmlnLndvcmtmbG93cy5tYXhFeGVjdXRpb25UaW1lIDw9IDApIHtcbiAgICAgIGVycm9ycy5wdXNoKCdNYXggZXhlY3V0aW9uIHRpbWUgbXVzdCBiZSBwb3NpdGl2ZScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy53b3JrZmxvd3MuZGVmYXVsdFJldHJ5QXR0ZW1wdHMgPCAwKSB7XG4gICAgICBlcnJvcnMucHVzaCgnRGVmYXVsdCByZXRyeSBhdHRlbXB0cyBtdXN0IGJlIG5vbi1uZWdhdGl2ZScpO1xuICAgIH1cblxuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gZmFpbGVkOiAke2Vycm9ycy5qb2luKCcsICcpfWApO1xuICAgIH1cbiAgfVxuXG4gIC8vIERlZXAgbWVyZ2UgY29uZmlndXJhdGlvbiBvYmplY3RzXG4gIHByaXZhdGUgbWVyZ2VDb25maWcoYmFzZTogQmVkcm9ja0FnZW50c0NvbmZpZywgdXBkYXRlczogUGFydGlhbDxCZWRyb2NrQWdlbnRzQ29uZmlnPik6IEJlZHJvY2tBZ2VudHNDb25maWcge1xuICAgIGNvbnN0IHJlc3VsdCA9IHsgLi4uYmFzZSB9O1xuXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModXBkYXRlcykpIHtcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgIChyZXN1bHQgYXMgYW55KVtrZXldID0geyAuLi4ocmVzdWx0IGFzIGFueSlba2V5XSwgLi4udmFsdWUgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAocmVzdWx0IGFzIGFueSlba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG4vLyBFbnZpcm9ubWVudC1zcGVjaWZpYyBjb25maWd1cmF0aW9uc1xuZXhwb3J0IGNvbnN0IGRldmVsb3BtZW50Q29uZmlnOiBQYXJ0aWFsPEJlZHJvY2tBZ2VudHNDb25maWc+ID0ge1xuICBsb2dnaW5nOiB7XG4gICAgbGV2ZWw6ICdkZWJ1ZycsXG4gICAgZW5hYmxlTWV0cmljczogdHJ1ZSxcbiAgICBlbmFibGVUcmFjaW5nOiB0cnVlLFxuICB9LFxuICB3b3JrZmxvd3M6IHtcbiAgICBtYXhFeGVjdXRpb25UaW1lOiA2MDAwMDAsIC8vIDEwIG1pbnV0ZXMgZm9yIGRldmVsb3BtZW50XG4gICAgZGVmYXVsdFJldHJ5QXR0ZW1wdHM6IDEsIC8vIEZld2VyIHJldHJpZXMgZm9yIGZhc3RlciBmZWVkYmFja1xuICAgIGNsZWFudXBJbnRlcnZhbDogMTgwMDAwMCwgLy8gMzAgbWludXRlc1xuICB9LFxufTtcblxuZXhwb3J0IGNvbnN0IHByb2R1Y3Rpb25Db25maWc6IFBhcnRpYWw8QmVkcm9ja0FnZW50c0NvbmZpZz4gPSB7XG4gIGxvZ2dpbmc6IHtcbiAgICBsZXZlbDogJ3dhcm4nLFxuICAgIGVuYWJsZU1ldHJpY3M6IHRydWUsXG4gICAgZW5hYmxlVHJhY2luZzogZmFsc2UsXG4gIH0sXG4gIHdvcmtmbG93czoge1xuICAgIG1heEV4ZWN1dGlvblRpbWU6IDMwMDAwMCwgLy8gNSBtaW51dGVzXG4gICAgZGVmYXVsdFJldHJ5QXR0ZW1wdHM6IDMsXG4gICAgY2xlYW51cEludGVydmFsOiAzNjAwMDAwLCAvLyAxIGhvdXJcbiAgfSxcbn07XG5cbmV4cG9ydCBjb25zdCB0ZXN0Q29uZmlnOiBQYXJ0aWFsPEJlZHJvY2tBZ2VudHNDb25maWc+ID0ge1xuICBhZ2VudHM6IHtcbiAgICBkZWZhdWx0TW9kZWxJZDogJ21vY2stbW9kZWwnLFxuICAgIGRlZmF1bHRUZW1wZXJhdHVyZTogMC41LFxuICAgIGRlZmF1bHRNYXhUb2tlbnM6IDEwMDAsXG4gICAgZGVmYXVsdFRvcFA6IDAuOCxcbiAgICB0aW1lb3V0OiA1MDAwLCAvLyA1IHNlY29uZHMgZm9yIHRlc3RzXG4gIH0sXG4gIGxvZ2dpbmc6IHtcbiAgICBsZXZlbDogJ2Vycm9yJyxcbiAgICBlbmFibGVNZXRyaWNzOiBmYWxzZSxcbiAgICBlbmFibGVUcmFjaW5nOiBmYWxzZSxcbiAgfSxcbiAgd29ya2Zsb3dzOiB7XG4gICAgbWF4RXhlY3V0aW9uVGltZTogMzAwMDAsIC8vIDMwIHNlY29uZHMgZm9yIHRlc3RzXG4gICAgZGVmYXVsdFJldHJ5QXR0ZW1wdHM6IDEsXG4gICAgY2xlYW51cEludGVydmFsOiA2MDAwMCwgLy8gMSBtaW51dGVcbiAgfSxcbn07XG5cbi8vIFV0aWxpdHkgZnVuY3Rpb25zXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW52aXJvbm1lbnRDb25maWcoKTogUGFydGlhbDxCZWRyb2NrQWdlbnRzQ29uZmlnPiB7XG4gIGNvbnN0IGVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCc7XG4gIFxuICBzd2l0Y2ggKGVudikge1xuICAgIGNhc2UgJ3Byb2R1Y3Rpb24nOlxuICAgICAgcmV0dXJuIHByb2R1Y3Rpb25Db25maWc7XG4gICAgY2FzZSAndGVzdCc6XG4gICAgICByZXR1cm4gdGVzdENvbmZpZztcbiAgICBjYXNlICdkZXZlbG9wbWVudCc6XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBkZXZlbG9wbWVudENvbmZpZztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29uZmlnRnJvbUVudmlyb25tZW50KCk6IEJlZHJvY2tBZ2VudHNDb25maWcge1xuICBjb25zdCBlbnZDb25maWcgPSBnZXRFbnZpcm9ubWVudENvbmZpZygpO1xuICBjb25zdCBtYW5hZ2VyID0gQ29uZmlnTWFuYWdlci5nZXRJbnN0YW5jZShlbnZDb25maWcpO1xuICBtYW5hZ2VyLnZhbGlkYXRlQ29uZmlnKCk7XG4gIHJldHVybiBtYW5hZ2VyLmdldENvbmZpZygpO1xufSJdfQ==